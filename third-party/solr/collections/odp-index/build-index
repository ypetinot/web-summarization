#!/bin/bash

# Note : indexing triggers required (non-dynamic) field generation 

BINDIR=`dirname $0`

# TODO : load dist.rc instead
BINDIR_DATA=${BINDIR}/../../../../data/bin/

FIELDS_INDEX="id,url,category,description,title,content_rendered"
# TODO: add support for anchortext-basic/extended indexing
FIELDS_CORPUS_INDEX="_url _category summary title content.rendered"
# CURRENT : probably should happen inside run-data-generation
#FIELDS_CORPUS_GENERATE="summary.chunked.refined"

# CURRENT : I probably want to generate features on a per-category basis (ultimately it would be per record) so that it can truly be distributed and processsed using this script
# CURRENT : update/extract to go through Solr Cell / Apache Tika ?
${BINDIR_DATA}/dmoz-corpus-fold 0 ${FIELDS_CORPUS_INDEX} ${FIELDS_CORPUS_GENERATE} | tee build-index.log | grep -v '"' | curl "http://barracuda.cs.columbia.edu:8080/solr_context/odp-index/update/csv?commit=true&separator=%09&fieldnames=${FIELDS_INDEX}" --no-buffer --data-binary @- -H 'Content-type:text/plain; charset=utf-8'
